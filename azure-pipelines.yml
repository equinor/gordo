# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml


trigger: 
  - master

jobs:

- job: "testall"
  pool:
    vmImage: 'Ubuntu-16.04'
  steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: 3.6
      architecture: 'x64'
  - script: |
      python -m pip install --upgrade pip setuptools 
      pip install -r requirements.txt
      pip install .
      # make coverage
  - script: |
      pip install pytest
      pip install pytest-cov
      python setup.py alltests
  - task: PublishTestResults@2
    condition: succeededOrFailed()
    inputs:
      testResultsFiles: '**/test-*.xml'
      testRunTitle: $(Agent.OS) - $(Build.BuildNumber)[$(Agent.JobName)]'
- job: "make_images"
  pool:
    vmImage: 'Ubuntu-16.04'
  steps:
  - script: make images
- job: "make_docs"
  pool:
    vmImage: 'Ubuntu-16.04'
  steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: 3.6
      architecture: 'x64'
  - script: |
      python -m pip install --upgrade pip setuptools 
      pip install -r requirements.txt
      make docs